# מערכת הרשאות משתמשים

## סקירה כללית

המערכת מאפשרת הקצאת הרשאות ספציפיות למשתמשים שונים, כך שכל משתמש יכול לנהל רק את התחומים שבאחריותו.

## סוגי הרשאות

1. **admin** - מנהל ראשי (גישה מלאה לכל המערכת)
2. **prayers_manager** - אחראי תפילות
3. **videos_manager** - אחראי מבית רבנו (סרטונים)
4. **music_manager** - אחראי ניגונים
5. **books_manager** - אחראי ספר תולדות אדם
6. **learning_manager** - אחראי ספריית לימוד (סרטונים קצרים + ארוכים)

## איך זה עובד?

### 1. ניהול הרשאות (למנהלים בלבד)

המנהל הראשי יכול לגשת למסך "ניהול הרשאות" דרך פאנל האדמין:
- לחץ על אייקון האנשים בפינה השמאלית העליונה של פאנל האדמין
- בחר משתמש מהרשימה
- סמן/בטל את ההרשאות הרלוונטיות
- השינויים נשמרים אוטומטית

### 2. השפעת ההרשאות

כל הרשאה נותנת גישה לניהול התחום המתאים:

#### prayers_manager (אחראי תפילות)
- יכולת להוסיף תפילות חדשות
- יכולת לערוך תפילות קיימות
- יכולת למחוק תפילות

#### videos_manager (אחראי מבית רבנו)
- יכולת להוסיף סרטונים חדשים למבית רבנו
- יכולת לערוך סרטונים קיימים
- יכולת למחוק סרטונים

#### music_manager (אחראי ניגונים)
- יכולת להוסיף ניגונים חדשים
- יכולת לערוך ניגונים קיימים
- יכולת למחוק ניגונים

#### books_manager (אחראי ספר תולדות אדם)
- יכולת להוסיף ספרים חדשים
- יכולת לערוך ספרים קיימים
- יכולת למחוק ספרים

#### learning_manager (אחראי ספריית לימוד)
- יכולת להוסיף סרטונים קצרים וארוכים
- יכולת לערוך סרטונים קיימים
- יכולת למחוק סרטונים

### 3. הוספת הרשאות באמצעות סקריפט

אפשר גם להשתמש בסקריפט כדי להוסיף הרשאות למשתמש:

\`\`\`bash
cd native
node scripts/add-user-permissions.cjs user@example.com prayers_manager,learning_manager
\`\`\`

זה יעניק למשתמש עם האימייל `user@example.com` הרשאות לניהול תפילות וספריית לימוד.

## מבנה טכני

### Firestore
כל משתמש ב-collection `users` יכול לכלול שדה `permissions` שהוא מערך של מחרוזות:

\`\`\`javascript
{
  name: "משה כהן",
  email: "moshe@example.com",
  role: "user",
  permissions: ["prayers_manager", "learning_manager"],
  createdAt: "2024-01-01T00:00:00.000Z"
}
\`\`\`

### קוד
פונקציות בדיקת הרשאות זמינות ב-`src/utils/permissions.js`:

\`\`\`javascript
import { canManagePrayers, canManageVideos, canManageLearning } from '../utils/permissions';

// בדיקה אם משתמש יכול לנהל תפילות
const canManage = canManagePrayers(userRole, userPermissions);
\`\`\`

## דוגמאות שימוש

### דוגמה 1: משתמש שאחראי על תפילות ולימוד
\`\`\`javascript
permissions: ["prayers_manager", "learning_manager"]
\`\`\`

משתמש זה יוכל:
- להוסיף/לערוך/למחוק תפילות
- להוסיף/לערוך/למחוק סרטוני לימוד (קצרים וארוכים)

### דוגמה 2: משתמש שאחראי רק על ניגונים
\`\`\`javascript
permissions: ["music_manager"]
\`\`\`

משתמש זה יוכל:
- להוסיף/לערוך/למחוק ניגונים בלבד

### דוגמה 3: מנהל ראשי
\`\`\`javascript
role: "admin"
\`\`\`

מנהל ראשי אינו צריך הרשאות נוספות - יש לו גישה לכל המערכת.

## שמירת סשן המשתמש

המערכת משתמשת ב-Firebase Authentication עם AsyncStorage לשמירת הסשן:
- המשתמש נשאר מחובר אוטומטית עד שהוא לוחץ "התנתק"
- אין צורך ב"זכור אותי" - זה קורה אוטומטית
- הסשן נשמר גם אחרי סגירת האפליקציה

## שאלות נפוצות

**ש: איך אני הופך משתמש למנהל ראשי?**

ת: יש לעדכן את שדה `role` ל-`admin` ישירות ב-Firestore או באמצעות סקריפט ייעודי.

**ש: משתמש יכול לקבל יותר מהרשאה אחת?**

ת: כן! משתמש יכול לקבל כמה הרשאות שרוצים.

**ש: מה קורה אם אני מוחק הרשאה ממשתמש שמחובר?**

ת: השינוי ייכנס לתוקף ברגע שהמשתמש ייכנס מחדש לאפליקציה.

**ש: איך אני יכול לראות את כל ההרשאות של משתמש?**

ת: במסך "ניהול הרשאות" תוכל לראות את כל המשתמשים וההרשאות שלהם.
