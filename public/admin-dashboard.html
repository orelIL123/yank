<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>×œ×•×— ×‘×§×¨×” - ××“××™×Ÿ ×™× ×•×§×</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      min-height: 100vh;
      direction: rtl;
    }

    /* LOGIN */
    #login-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%);
    }
    #login-screen .login-card {
      background: #1e293b;
      border-radius: 16px;
      padding: 40px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 25px 50px rgba(0,0,0,0.5);
    }
    #login-screen h1 {
      font-size: 24px;
      margin-bottom: 8px;
      text-align: center;
      color: #93c5fd;
    }
    #login-screen p {
      text-align: center;
      color: #94a3b8;
      margin-bottom: 32px;
      font-size: 14px;
    }
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 6px; font-size: 14px; color: #94a3b8; }
    .form-group input {
      width: 100%; padding: 12px 16px;
      background: #0f172a; border: 1px solid #334155;
      border-radius: 8px; color: #e2e8f0; font-size: 16px;
      direction: ltr; text-align: left;
    }
    .form-group input:focus { outline: none; border-color: #3b82f6; }
    .btn-primary {
      width: 100%; padding: 14px;
      background: linear-gradient(135deg, #1e3a8a, #3b82f6);
      border: none; border-radius: 8px; color: white;
      font-size: 16px; font-weight: 600; cursor: pointer;
      transition: opacity 0.2s;
    }
    .btn-primary:hover { opacity: 0.9; }
    .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
    #login-error { color: #f87171; text-align: center; margin-top: 12px; font-size: 14px; }

    /* DASHBOARD */
    #dashboard { display: none; }

    .topbar {
      background: #1e293b;
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #334155;
      position: sticky; top: 0; z-index: 100;
    }
    .topbar-title { font-size: 20px; font-weight: 700; color: #93c5fd; }
    .topbar-right { display: flex; align-items: center; gap: 16px; }
    .live-badge {
      display: flex; align-items: center; gap: 6px;
      background: #064e3b; color: #6ee7b7;
      padding: 4px 12px; border-radius: 20px; font-size: 13px;
    }
    .live-dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: #10b981; animation: pulse 2s infinite;
    }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }
    .btn-logout {
      background: #374151; border: none; color: #e2e8f0;
      padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 14px;
    }
    .btn-logout:hover { background: #4b5563; }

    .main-content { padding: 24px; max-width: 1400px; margin: 0 auto; }

    /* STATS GRID */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    .stat-card {
      background: #1e293b;
      border-radius: 12px;
      padding: 20px;
      border: 1px solid #334155;
      transition: transform 0.2s;
    }
    .stat-card:hover { transform: translateY(-2px); }
    .stat-card .stat-icon {
      font-size: 28px; margin-bottom: 8px;
    }
    .stat-card .stat-value {
      font-size: 32px; font-weight: 700; color: #f1f5f9;
    }
    .stat-card .stat-label {
      font-size: 13px; color: #64748b; margin-top: 4px;
    }
    .stat-card .stat-change {
      font-size: 12px; margin-top: 6px;
    }
    .stat-card .stat-change.up { color: #10b981; }
    .stat-card .stat-change.neutral { color: #94a3b8; }

    /* CHARTS GRID */
    .charts-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 24px;
    }
    @media (max-width: 900px) { .charts-grid { grid-template-columns: 1fr; } }

    .chart-card {
      background: #1e293b;
      border-radius: 12px;
      padding: 20px;
      border: 1px solid #334155;
    }
    .chart-card h3 {
      font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #cbd5e1;
    }

    /* BAR CHART */
    .bar-chart { display: flex; flex-direction: column; gap: 10px; }
    .bar-row { display: flex; align-items: center; gap: 10px; }
    .bar-label { min-width: 160px; font-size: 13px; color: #94a3b8; text-align: right; }
    .bar-track { flex: 1; background: #0f172a; border-radius: 4px; height: 20px; position: relative; }
    .bar-fill {
      height: 100%; border-radius: 4px;
      background: linear-gradient(90deg, #1e3a8a, #3b82f6);
      transition: width 0.8s ease;
      display: flex; align-items: center; justify-content: flex-end; padding-right: 8px;
      min-width: 24px;
    }
    .bar-fill span { font-size: 11px; color: white; font-weight: 600; }

    /* TABLE */
    .table-card {
      background: #1e293b;
      border-radius: 12px;
      padding: 20px;
      border: 1px solid #334155;
      margin-bottom: 24px;
      overflow-x: auto;
    }
    .table-card h3 {
      font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #cbd5e1;
    }
    table { width: 100%; border-collapse: collapse; }
    th {
      text-align: right; padding: 10px 12px;
      background: #0f172a; color: #64748b; font-size: 13px;
      border-bottom: 1px solid #334155;
    }
    td {
      padding: 10px 12px; font-size: 14px; color: #cbd5e1;
      border-bottom: 1px solid #1e293b;
    }
    tr:hover td { background: #263045; }
    .badge {
      padding: 2px 8px; border-radius: 12px; font-size: 12px;
    }
    .badge-green { background: #064e3b; color: #6ee7b7; }
    .badge-blue { background: #1e3a8a; color: #93c5fd; }
    .badge-gray { background: #374151; color: #9ca3af; }

    /* LOADING */
    .loading-spinner {
      display: inline-block; width: 20px; height: 20px;
      border: 2px solid #334155; border-top-color: #3b82f6;
      border-radius: 50%; animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading-state {
      display: flex; align-items: center; justify-content: center;
      padding: 40px; color: #64748b; gap: 12px;
    }

    /* REFRESH */
    .btn-refresh {
      background: #374151; border: none; color: #93c5fd;
      padding: 8px 14px; border-radius: 8px; cursor: pointer; font-size: 13px;
      margin-right: 8px;
    }
    .btn-refresh:hover { background: #4b5563; }

    .section-header {
      display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;
    }
    .last-updated { font-size: 12px; color: #475569; }
  </style>
</head>
<body>

<!-- LOGIN -->
<div id="login-screen">
  <div class="login-card">
    <h1>ğŸ” ×œ×•×— ×‘×§×¨×”</h1>
    <p>×™× ×•×§× - ×¤×× ×œ ××“××™×Ÿ</p>
    <div class="form-group">
      <label>××™××™×™×œ</label>
      <input type="email" id="login-email" placeholder="admin@example.com" />
    </div>
    <div class="form-group">
      <label>×¡×™×¡××”</label>
      <input type="password" id="login-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
    </div>
    <button class="btn-primary" id="login-btn" onclick="doLogin()">×›× ×™×¡×”</button>
    <div id="login-error"></div>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboard">
  <div class="topbar">
    <div class="topbar-title">ğŸ“Š ×œ×•×— ×‘×§×¨×” - ×™× ×•×§×</div>
    <div class="topbar-right">
      <div class="live-badge">
        <div class="live-dot"></div>
        <span id="active-count">0</span> ×¤×¢×™×œ×™× ×¢×›×©×™×•
      </div>
      <button class="btn-refresh" onclick="loadAllData()">ğŸ”„ ×¨×¢× ×Ÿ</button>
      <button class="btn-logout" onclick="doLogout()">×™×¦×™××”</button>
    </div>
  </div>

  <div class="main-content">
    <!-- Stats -->
    <div class="stats-grid" id="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">ğŸ‘¥</div>
        <div class="stat-value" id="stat-sessions">â€”</div>
        <div class="stat-label">×¡×”"×› ×¤×ª×™×—×•×ª ××¤×œ×™×§×¦×™×”</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ”‘</div>
        <div class="stat-value" id="stat-logins">â€”</div>
        <div class="stat-label">×›× ×™×¡×•×ª</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ“±</div>
        <div class="stat-value" id="stat-devices">â€”</div>
        <div class="stat-label">××›×©×™×¨×™× ×™×™×—×•×“×™×™×</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">â±ï¸</div>
        <div class="stat-value" id="stat-avg-duration">â€”</div>
        <div class="stat-label">×–××Ÿ ×××•×¦×¢ ×‘×“×§×•×ª</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ“²</div>
        <div class="stat-value" id="stat-installs">â€”</div>
        <div class="stat-label">×”×•×¨×“×•×ª ××¤×œ×™×§×¦×™×”</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">âœ¨</div>
        <div class="stat-value" id="stat-registrations">â€”</div>
        <div class="stat-label">×”×¨×©××•×ª</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">âŒ</div>
        <div class="stat-value" id="stat-errors">â€”</div>
        <div class="stat-label">×©×’×™××•×ª</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ“š</div>
        <div class="stat-value" id="stat-total-events">â€”</div>
        <div class="stat-label">×¡×”"×› ××™×¨×•×¢×™×</div>
      </div>
    </div>

    <!-- Charts -->
    <div class="charts-grid">
      <div class="chart-card">
        <h3>ğŸ† ××¡×›×™× ×¤×•×¤×•×œ×¨×™×™×</h3>
        <div class="bar-chart" id="screen-chart">
          <div class="loading-state"><div class="loading-spinner"></div> ×˜×•×¢×Ÿ...</div>
        </div>
      </div>
      <div class="chart-card">
        <h3>âš¡ ×¤×¢×•×œ×•×ª × ×¤×•×¦×•×ª</h3>
        <div class="bar-chart" id="actions-chart">
          <div class="loading-state"><div class="loading-spinner"></div> ×˜×•×¢×Ÿ...</div>
        </div>
      </div>
    </div>

    <!-- Content Stats -->
    <div class="charts-grid">
      <div class="chart-card">
        <h3>ğŸ“– ×ª×•×›×Ÿ ×¤×•×¤×•×œ×¨×™</h3>
        <div class="bar-chart" id="content-chart">
          <div class="loading-state"><div class="loading-spinner"></div> ×˜×•×¢×Ÿ...</div>
        </div>
      </div>
      <div class="chart-card">
        <h3>âŒ ×©×’×™××•×ª ××—×¨×•× ×•×ª</h3>
        <div id="errors-list" style="max-height:300px;overflow-y:auto;">
          <div class="loading-state"><div class="loading-spinner"></div> ×˜×•×¢×Ÿ...</div>
        </div>
      </div>
    </div>

    <!-- Recent Events Table -->
    <div class="table-card">
      <div class="section-header">
        <h3>ğŸ“‹ ××™×¨×•×¢×™× ××—×¨×•× ×™×</h3>
        <span class="last-updated" id="last-updated-text">â€”</span>
      </div>
      <table>
        <thead>
          <tr>
            <th>×–××Ÿ</th>
            <th>×¡×•×’</th>
            <th>××¡×š / ×¤×¢×•×œ×”</th>
            <th>××›×©×™×¨</th>
          </tr>
        </thead>
        <tbody id="events-table-body">
          <tr><td colspan="4"><div class="loading-state"><div class="loading-spinner"></div> ×˜×•×¢×Ÿ...</div></td></tr>
        </tbody>
      </table>
    </div>

    <!-- Active Sessions -->
    <div class="table-card">
      <div class="section-header">
        <h3>ğŸŸ¢ ×¡×©× ×™× ×¤×¢×™×œ×™× (×©×™×“×•×¨ ×—×™)</h3>
      </div>
      <div id="active-sessions-list">
        <div class="loading-state"><div class="loading-spinner"></div> ×˜×•×¢×Ÿ...</div>
      </div>
    </div>

  </div>
</div>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js'
  import {
    getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged
  } from 'https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js'
  import {
    getFirestore, collection, query, orderBy, limit, getDocs,
    doc, getDoc, onSnapshot, where, Timestamp
  } from 'https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js'

  // ============================
  // CONFIG
  // ============================
  const firebaseConfig = {
    apiKey: "AIzaSyC6CfvVURku2xMCgnhIGQbc4vQTKLP3SYA",
    authDomain: "yank-99f79.firebaseapp.com",
    projectId: "yank-99f79",
    storageBucket: "yank-99f79.firebasestorage.app",
    messagingSenderId: "835481530038",
    appId: "1:835481530038:web:cd4141f7f1d099a26bc017"
  }

  const app = initializeApp(firebaseConfig)
  const auth = getAuth(app)
  const db = getFirestore(app)

  // Expose globals for onclick handlers
  window._auth = auth
  window._db = db

  // ============================
  // AUTH
  // ============================
  window.doLogin = async function() {
    const email = document.getElementById('login-email').value.trim()
    const password = document.getElementById('login-password').value
    const btn = document.getElementById('login-btn')
    const errEl = document.getElementById('login-error')
    errEl.textContent = ''
    btn.disabled = true
    btn.textContent = '××ª×—×‘×¨...'
    try {
      await signInWithEmailAndPassword(auth, email, password)
    } catch(e) {
      errEl.textContent = '×©×’×™××”: ' + (e.code === 'auth/wrong-password' || e.code === 'auth/user-not-found'
        ? '××™××™×™×œ ××• ×¡×™×¡××” ×©×’×•×™×™×'
        : e.message)
      btn.disabled = false
      btn.textContent = '×›× ×™×¡×”'
    }
  }

  window.doLogout = async function() {
    await signOut(auth)
  }

  onAuthStateChanged(auth, async (user) => {
    if (user) {
      document.getElementById('login-screen').style.display = 'none'
      document.getElementById('dashboard').style.display = 'block'
      loadAllData()
      startRealtime()
    } else {
      document.getElementById('login-screen').style.display = 'flex'
      document.getElementById('dashboard').style.display = 'none'
      document.getElementById('login-btn').disabled = false
      document.getElementById('login-btn').textContent = '×›× ×™×¡×”'
    }
  })

  // Enter key on login
  document.getElementById('login-password').addEventListener('keydown', e => {
    if (e.key === 'Enter') window.doLogin()
  })

  // ============================
  // DATA LOADING
  // ============================
  window.loadAllData = async function() {
    try {
      await Promise.all([
        loadGlobalStats(),
        loadScreenStats(),
        loadActionStats(),
        loadRecentEvents(),
        loadContentStats(),
        loadErrors(),
      ])
      document.getElementById('last-updated-text').textContent =
        '×¢×•×“×›×Ÿ: ' + new Date().toLocaleTimeString('he-IL')
    } catch(e) {
      console.error('Error loading data:', e)
    }
  }

  async function loadGlobalStats() {
    // Global stats
    try {
      const snap = await getDoc(doc(db, 'analytics_stats', 'global'))
      const d = snap.data() || {}
      document.getElementById('stat-sessions').textContent = fmtNum(d.totalSessions)
      document.getElementById('stat-logins').textContent = fmtNum(d.totalLogins)
      document.getElementById('stat-installs').textContent = fmtNum(d.totalInstalls)
      document.getElementById('stat-registrations').textContent = fmtNum(d.totalRegistrations)
      document.getElementById('stat-errors').textContent = fmtNum(d.totalErrors)

      // Avg duration in minutes
      const sessions = d.totalSessions || 1
      const avgSec = (d.totalSessionDuration || 0) / sessions
      document.getElementById('stat-avg-duration').textContent = Math.round(avgSec / 60)
    } catch(e) { console.error('global stats:', e) }

    // Unique devices from events
    try {
      const q = query(collection(db, 'analytics_events'), orderBy('timestamp', 'desc'), limit(500))
      const snap = await getDocs(q)
      const devices = new Set()
      snap.forEach(d => { if (d.data().deviceId) devices.add(d.data().deviceId) })
      document.getElementById('stat-devices').textContent = fmtNum(devices.size)
      document.getElementById('stat-total-events').textContent = fmtNum(snap.size)
    } catch(e) { console.error('devices stats:', e) }
  }

  async function loadScreenStats() {
    try {
      const q = query(collection(db, 'analytics_screen_stats'), orderBy('views', 'desc'), limit(15))
      const snap = await getDocs(q)
      const items = []
      snap.forEach(d => items.push(d.data()))
      renderBarChart('screen-chart', items, 'screenName', 'views', translateScreen)
    } catch(e) {
      document.getElementById('screen-chart').innerHTML =
        '<div class="loading-state">âŒ ×©×’×™××” ×‘×˜×¢×™× ×”</div>'
    }
  }

  async function loadActionStats() {
    try {
      const snap = await getDoc(doc(db, 'analytics_stats', 'actions'))
      const d = snap.data() || {}
      delete d.lastUpdated
      const items = Object.entries(d)
        .map(([k, v]) => ({ action: k, count: v }))
        .sort((a, b) => b.count - a.count)
        .slice(0, 10)
      renderBarChart('actions-chart', items, 'action', 'count', v => v)
    } catch(e) {
      document.getElementById('actions-chart').innerHTML =
        '<div class="loading-state">âŒ ×©×’×™××” ×‘×˜×¢×™× ×”</div>'
    }
  }

  async function loadRecentEvents() {
    try {
      const q = query(collection(db, 'analytics_events'), orderBy('timestamp', 'desc'), limit(50))
      const snap = await getDocs(q)
      const rows = []
      snap.forEach(d => rows.push(d.data()))
      renderEventsTable(rows)
    } catch(e) {
      document.getElementById('events-table-body').innerHTML =
        '<tr><td colspan="4"><div class="loading-state">âŒ ×©×’×™××” ×‘×˜×¢×™× ×”</div></td></tr>'
    }
  }

  async function loadContentStats() {
    try {
      const q = query(collection(db, 'analytics_content_stats'), orderBy('views', 'desc'), limit(10))
      const snap = await getDocs(q)
      const items = []
      snap.forEach(d => items.push(d.data()))
      renderBarChart('content-chart', items, 'contentTitle', 'views', v => v || '×œ×œ× ×›×•×ª×¨×ª')
    } catch(e) {
      document.getElementById('content-chart').innerHTML =
        '<div class="loading-state">âŒ ×©×’×™××” ×‘×˜×¢×™× ×”</div>'
    }
  }

  async function loadErrors() {
    try {
      const q = query(
        collection(db, 'analytics_events'),
        where('type', '==', 'error'),
        orderBy('timestamp', 'desc'),
        limit(10)
      )
      const snap = await getDocs(q)
      const errors = []
      snap.forEach(d => errors.push(d.data()))
      renderErrors(errors)
    } catch(e) {
      document.getElementById('errors-list').innerHTML =
        '<div class="loading-state">âŒ ×©×’×™××” ×‘×˜×¢×™× ×”</div>'
    }
  }

  // ============================
  // REALTIME
  // ============================
  function startRealtime() {
    // Active users via active_users doc
    onSnapshot(doc(db, 'analytics_stats', 'active_users'), (snap) => {
      const d = snap.data()
      if (!d || !d.devices) {
        document.getElementById('active-count').textContent = '0'
        document.getElementById('active-sessions-list').innerHTML = '<p style="color:#64748b;padding:12px">××™×Ÿ ××©×ª××©×™× ×¤×¢×™×œ×™× ×›×¨×’×¢</p>'
        return
      }
      const fiveMinAgo = Date.now() - 5 * 60 * 1000
      const active = Object.entries(d.devices).filter(([, v]) => {
        const ts = v.lastSeen?.toMillis?.() || 0
        return ts > fiveMinAgo
      })
      document.getElementById('active-count').textContent = active.length
      renderActiveSessions(active)
    })

    // Live events feed
    onSnapshot(
      query(collection(db, 'analytics_events'), orderBy('timestamp', 'desc'), limit(20)),
      (snap) => {
        const rows = []
        snap.forEach(d => rows.push(d.data()))
        renderEventsTable(rows)
        document.getElementById('last-updated-text').textContent =
          '×©×™×“×•×¨ ×—×™ â€¢ ' + new Date().toLocaleTimeString('he-IL')
      }
    )
  }

  // ============================
  // RENDERERS
  // ============================
  function renderBarChart(containerId, items, labelKey, valueKey, labelFn) {
    const el = document.getElementById(containerId)
    if (!items.length) {
      el.innerHTML = '<div class="loading-state" style="color:#64748b">××™×Ÿ × ×ª×•× ×™× ×¢×“×™×™×Ÿ</div>'
      return
    }
    const max = Math.max(...items.map(i => i[valueKey] || 0))
    el.innerHTML = items.map(item => {
      const val = item[valueKey] || 0
      const pct = max > 0 ? (val / max * 100).toFixed(0) : 0
      const label = labelFn(item[labelKey] || '')
      return `<div class="bar-row">
        <div class="bar-label">${label}</div>
        <div class="bar-track">
          <div class="bar-fill" style="width:${pct}%"><span>${val}</span></div>
        </div>
      </div>`
    }).join('')
  }

  function renderEventsTable(rows) {
    const tbody = document.getElementById('events-table-body')
    if (!rows.length) {
      tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:#64748b;padding:20px">××™×Ÿ ××™×¨×•×¢×™× ×¢×“×™×™×Ÿ</td></tr>'
      return
    }
    tbody.innerHTML = rows.map(r => {
      const time = r.timestamp?.toDate?.() ? formatTime(r.timestamp.toDate()) : 'â€”'
      const type = r.type === 'screen_view' ? '<span class="badge badge-blue">××¡×š</span>'
                  : r.type === 'login' ? '<span class="badge badge-green">×›× ×™×¡×”</span>'
                  : r.type === 'action' ? '<span class="badge badge-gray">×¤×¢×•×œ×”</span>'
                  : `<span class="badge badge-gray">${r.type}</span>`
      const detail = r.screen ? translateScreen(r.screen) : (r.action || 'â€”')
      const device = r.deviceId ? r.deviceId.substring(0, 10) + 'â€¦' : 'â€”'
      return `<tr><td>${time}</td><td>${type}</td><td>${detail}</td><td dir="ltr">${device}</td></tr>`
    }).join('')
  }

  function renderActiveSessions(active) {
    const el = document.getElementById('active-sessions-list')
    if (!active.length) {
      el.innerHTML = '<p style="color:#64748b;padding:12px">××™×Ÿ ××©×ª××©×™× ×¤×¢×™×œ×™× ×›×¨×’×¢</p>'
      return
    }
    el.innerHTML = `<div style="display:flex;flex-wrap:wrap;gap:12px;padding:4px">` +
      active.map(([deviceId, info]) => {
        const lastSeen = info.lastSeen?.toDate?.() ? '×œ×¤× ×™ ' + timeAgo(info.lastSeen.toDate()) : ''
        return `<div style="background:#0f172a;border-radius:8px;padding:12px 16px;min-width:200px">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
            <div style="width:8px;height:8px;border-radius:50%;background:#10b981"></div>
            <span style="font-size:13px;color:#94a3b8">××›×©×™×¨ ${deviceId.substring(0, 8)}â€¦</span>
          </div>
          <div style="font-size:12px;color:#64748b">${lastSeen}</div>
          ${info.userId ? `<div style="font-size:11px;color:#475569">UID: ${info.userId.substring(0, 12)}â€¦</div>` : ''}
        </div>`
      }).join('') + '</div>'
  }

  function renderErrors(errors) {
    const el = document.getElementById('errors-list')
    if (!errors.length) {
      el.innerHTML = '<p style="color:#64748b;padding:12px">××™×Ÿ ×©×’×™××•×ª ğŸ‰</p>'
      return
    }
    el.innerHTML = errors.map(err => {
      const time = err.timestamp?.toDate?.() ? formatTime(err.timestamp.toDate()) : 'â€”'
      const screen = err.screen || 'â€”'
      const msg = err.error || '×©×’×™××” ×œ× ×™×“×•×¢×”'
      return `<div style="background:#0f172a;border-radius:8px;padding:12px;margin-bottom:8px;border-right:3px solid #ef4444">
        <div style="display:flex;justify-content:space-between;margin-bottom:4px">
          <span style="font-size:13px;color:#f87171;font-weight:600">${msg.substring(0, 60)}${msg.length > 60 ? 'â€¦' : ''}</span>
          <span style="font-size:11px;color:#64748b">${time}</span>
        </div>
        <div style="font-size:12px;color:#94a3b8">××¡×š: ${screen}</div>
        ${err.stack ? `<div style="font-size:10px;color:#64748b;margin-top:4px;font-family:monospace">${err.stack.substring(0, 100)}â€¦</div>` : ''}
      </div>`
    }).join('')
  }

  // ============================
  // HELPERS
  // ============================
  function fmtNum(n) { return n != null ? Number(n).toLocaleString('he-IL') : '0' }

  function formatTime(date) {
    const now = new Date()
    const diff = now - date
    if (diff < 60000) return '×¢×›×©×™×•'
    if (diff < 3600000) return Math.round(diff / 60000) + '×“×³'
    return date.toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' })
  }

  function timeAgo(date) {
    const diff = Date.now() - date.getTime()
    if (diff < 60000) return '×›××” ×©× ×™×•×ª'
    if (diff < 3600000) return Math.round(diff / 60000) + ' ×“×§×³'
    return Math.round(diff / 3600000) + ' ×©×¢×•×ª'
  }

  const SCREEN_NAMES = {
    Home: '×‘×™×ª', Login: '×›× ×™×¡×”', Prayers: '×ª×¤×™×œ×•×ª', PrayerDetail: '×¤×¨×˜×™ ×ª×¤×™×œ×”',
    Books: '×¡×¤×¨×™×', News: '×—×“×©×•×ª', NewsArticle: '×›×ª×‘×”', Music: '× ×™×’×•× ×™×',
    DailyLearning: '×œ×™××•×“ ×™×•××™', ShortLessons: '×©×™×¢×•×¨×™× ×§×¦×¨×™×', LongLessons: '×©×™×¢×•×¨×™× ××¨×•×›×™×',
    Tzadikim: '×¦×“×™×§×™×', TzadikDetail: '×¤×¨×˜×™ ×¦×“×™×§', Admin: '××“××™×Ÿ',
    Profile: '×¤×¨×•×¤×™×œ', Notifications: '×”×ª×¨××•×ª', DailySummary: '×¡×™×›×•× ×™×•××™',
    Tehillim: '×ª×”×™×œ×™×', Siddur: '×¡×™×“×•×¨', OrchotTzadikim: '××•×¨×—×•×ª ×¦×“×™×§×™×',
    BaalShemTovStories: '×¡×™×¤×•×¨×™ ×”×‘×¢×©"×˜', HoduLaHashem: '×”×•×“×• ×œ×”\'',
    SeferHaMidot: '×¡×¤×¨ ×”××™×“×•×ª', PidyonNefesh: '×¤×“×™×•×Ÿ × ×¤×©',
    Newsletters: '×¢×œ×•× ×™×', Courses: '×§×•×¨×¡×™×', Tools: '×›×œ×™×',
    Contact: '×¦×•×¨ ×§×©×¨', About: '××•×“×•×ª',
  }
  function translateScreen(name) {
    return SCREEN_NAMES[name] || name
  }
</script>
</body>
</html>
