[debug] [2025-12-07T09:15:54.939Z] ----------------------------------------------------------------------
[debug] [2025-12-07T09:15:54.942Z] Command:       /opt/homebrew/Cellar/node/24.4.1/bin/node /opt/homebrew/bin/firebase deploy --only firestore:indexes
[debug] [2025-12-07T09:15:54.942Z] CLI Version:   14.25.1
[debug] [2025-12-07T09:15:54.943Z] Platform:      darwin
[debug] [2025-12-07T09:15:54.943Z] Node Version:  v24.4.1
[debug] [2025-12-07T09:15:54.943Z] Time:          Sun Dec 07 2025 11:15:54 GMT+0200 (Israel Standard Time)
[debug] [2025-12-07T09:15:54.943Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-12-07T09:15:55.043Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2025-12-07T09:15:55.043Z] > authorizing via signed-in user (orel895@gmail.com)
[debug] [2025-12-07T09:15:55.043Z] [iam] checking project yank-99f79 for permissions ["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]
[debug] [2025-12-07T09:15:55.044Z] Checked if tokens are valid: false, expires at: 1765045532538
[debug] [2025-12-07T09:15:55.044Z] Checked if tokens are valid: false, expires at: 1765045532538
[debug] [2025-12-07T09:15:55.044Z] > refreshing access token with scopes: []
[debug] [2025-12-07T09:15:55.045Z] >>> [apiv2][query] POST https://www.googleapis.com/oauth2/v3/token [none]
[debug] [2025-12-07T09:15:55.045Z] >>> [apiv2][body] POST https://www.googleapis.com/oauth2/v3/token [omitted]
[debug] [2025-12-07T09:15:55.353Z] <<< [apiv2][status] POST https://www.googleapis.com/oauth2/v3/token 200
[debug] [2025-12-07T09:15:55.353Z] <<< [apiv2][body] POST https://www.googleapis.com/oauth2/v3/token [omitted]
[debug] [2025-12-07T09:15:55.367Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/yank-99f79:testIamPermissions [none]
[debug] [2025-12-07T09:15:55.367Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/yank-99f79:testIamPermissions x-goog-quota-user=projects/yank-99f79
[debug] [2025-12-07T09:15:55.367Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/yank-99f79:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[debug] [2025-12-07T09:15:56.505Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/yank-99f79:testIamPermissions 200
[debug] [2025-12-07T09:15:56.505Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/yank-99f79:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[info] 
[info] === Deploying to 'yank-99f79'...
[info] 
[info] i  deploying firestore 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[debug] [2025-12-07T09:15:56.508Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:15:56.508Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:15:56.508Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/yank-99f79/databases/(default) [none]
[debug] [2025-12-07T09:15:57.171Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/yank-99f79/databases/(default) 200
[debug] [2025-12-07T09:15:57.171Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/yank-99f79/databases/(default) {"name":"projects/yank-99f79/databases/(default)","uid":"4c5ad8af-061a-43e3-8b1d-835cacec1816","createTime":"2025-11-26T09:21:58.397949Z","updateTime":"2025-11-26T09:21:58.397949Z","locationId":"europe-west2","type":"FIRESTORE_NATIVE","concurrencyMode":"PESSIMISTIC","versionRetentionPeriod":"3600s","earliestVersionTime":"2025-12-07T08:15:57.219152Z","appEngineIntegrationMode":"DISABLED","keyPrefix":"g","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_DISABLED","deleteProtectionState":"DELETE_PROTECTION_DISABLED","databaseEdition":"STANDARD","freeTier":true,"realtimeUpdatesMode":"REALTIME_UPDATES_MODE_ENABLED","etag":"IP3F2oKSq5EDMKWT/43Aj5ED"}
[info] i  firestore: reading indexes from firestore.indexes.json... 
[info] i  cloud.firestore: checking native/firestore.rules for compilation errors... 
[debug] [2025-12-07T09:15:57.175Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:15:57.175Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:15:57.175Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/yank-99f79:test [none]
[debug] [2025-12-07T09:15:57.175Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/yank-99f79:test [omitted]
[debug] [2025-12-07T09:15:58.223Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/yank-99f79:test 200
[debug] [2025-12-07T09:15:58.223Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/yank-99f79:test {}
[info] ✔  cloud.firestore: rules file native/firestore.rules compiled successfully 
[info] i  firestore: deploying indexes... 
[debug] [2025-12-07T09:15:58.227Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:15:58.228Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:15:58.228Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/yank-99f79/databases/(default)/collectionGroups/-/indexes [none]
[debug] [2025-12-07T09:15:58.378Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/yank-99f79/databases/(default)/collectionGroups/-/indexes 200
[debug] [2025-12-07T09:15:58.379Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/yank-99f79/databases/(default)/collectionGroups/-/indexes {"indexes":[{"name":"projects/yank-99f79/databases/(default)/collectionGroups/tzadikim/indexes/CICAgNiav4AK","queryScope":"COLLECTION","fields":[{"fieldPath":"location","order":"ASCENDING"},{"fieldPath":"name","order":"ASCENDING"},{"fieldPath":"__name__","order":"ASCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/yank-99f79/databases/(default)/collectionGroups/courses/indexes/CICAgJim14AK","queryScope":"COLLECTION","fields":[{"fieldPath":"isPremium","order":"ASCENDING"},{"fieldPath":"order","order":"ASCENDING"},{"fieldPath":"__name__","order":"ASCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/yank-99f79/databases/(default)/collectionGroups/users/indexes/CICAgOjXh4EK","queryScope":"COLLECTION","fields":[{"fieldPath":"tier","order":"ASCENDING"},{"fieldPath":"createdAt","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/yank-99f79/databases/(default)/collectionGroups/shortLessons/indexes/CICAgNiroIEK","queryScope":"COLLECTION","fields":[{"fieldPath":"isActive","order":"ASCENDING"},{"fieldPath":"createdAt","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/yank-99f79/databases/(default)/collectionGroups/news/indexes/CICAgJj7z4EK","queryScope":"COLLECTION","fields":[{"fieldPath":"isPublished","order":"ASCENDING"},{"fieldPath":"publishedAt","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/yank-99f79/databases/(default)/collectionGroups/prayerCommitments/indexes/CICAgNjpgYIK","queryScope":"COLLECTION","fields":[{"fieldPath":"userId","order":"ASCENDING"},{"fieldPath":"createdAt","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/yank-99f79/databases/(default)/collectionGroups/homeCards/indexes/CICAgJjF9oIK","queryScope":"COLLECTION","fields":[{"fieldPath":"isActive","order":"ASCENDING"},{"fieldPath":"order","order":"ASCENDING"},{"fieldPath":"__name__","order":"ASCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/yank-99f79/databases/(default)/collectionGroups/longLessons/indexes/CICAgLiIkYMK","queryScope":"COLLECTION","fields":[{"fieldPath":"isActive","order":"ASCENDING"},{"fieldPath":"createdAt","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/yank-99f79/databases/(default)/collectionGroups/alerts/indexes/CICAgJiUpoMK","queryScope":"COLLECTION","fields":[{"fieldPath":"isActive","order":"ASCENDING"},{"fieldPath":"createdAt","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/yank-99f79/databases/(default)/collectionGroups/news/indexes/CICAgNi47oMK","queryScope":"COLLECTION","fields":[{"fieldPath":"category","order":"ASCENDING"},{"fieldPath":"publishedAt","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/yank-99f79/databases/(default)/collectionGroups/courses/indexes/CICAgOi39IkK","queryScope":"COLLECTION","fields":[{"fieldPath":"level","order":"ASCENDING"},{"fieldPath":"order","order":"ASCENDING"},{"fieldPath":"__name__","order":"ASCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/yank-99f79/databases/(default)/collectionGroups/alerts/indexes/CICAgOi3kJAK","queryScope":"COLLECTION","fields":[{"fieldPath":"targetAudience","arrayConfig":"CONTAINS"},{"fieldPath":"createdAt","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/yank-99f79/databases/(default)/collectionGroups/prayerCommitments/indexes/CICAgOi36pgK","queryScope":"COLLECTION","fields":[{"fieldPath":"prayerType","order":"ASCENDING"},{"fieldPath":"status","order":"ASCENDING"},{"fieldPath":"createdAt","order":"ASCENDING"},{"fieldPath":"__name__","order":"ASCENDING"}],"state":"READY","density":"SPARSE_ALL"}]}
[debug] [2025-12-07T09:15:58.380Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:15:58.380Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:15:58.380Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/yank-99f79/databases/(default)/collectionGroups/-/fields?filter=indexConfig.usesAncestorConfig=false OR ttlConfig:* [none]
[debug] [2025-12-07T09:15:58.527Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/yank-99f79/databases/(default)/collectionGroups/-/fields?filter=indexConfig.usesAncestorConfig=false OR ttlConfig:* 200
[debug] [2025-12-07T09:15:58.527Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/yank-99f79/databases/(default)/collectionGroups/-/fields?filter=indexConfig.usesAncestorConfig=false OR ttlConfig:* {"fields":[{"name":"projects/yank-99f79/databases/(default)/collectionGroups/__default__/fields/*","indexConfig":{"indexes":[{"queryScope":"COLLECTION","fields":[{"fieldPath":"*","order":"ASCENDING"}],"state":"READY"},{"queryScope":"COLLECTION","fields":[{"fieldPath":"*","order":"DESCENDING"}],"state":"READY"},{"queryScope":"COLLECTION","fields":[{"fieldPath":"*","arrayConfig":"CONTAINS"}],"state":"READY"}]}}]}
[debug] [2025-12-07T09:15:58.528Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:15:58.528Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:15:58.529Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/yank-99f79/databases/(default) [none]
[debug] [2025-12-07T09:15:58.667Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/yank-99f79/databases/(default) 200
[debug] [2025-12-07T09:15:58.668Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/yank-99f79/databases/(default) {"name":"projects/yank-99f79/databases/(default)","uid":"4c5ad8af-061a-43e3-8b1d-835cacec1816","createTime":"2025-11-26T09:21:58.397949Z","updateTime":"2025-11-26T09:21:58.397949Z","locationId":"europe-west2","type":"FIRESTORE_NATIVE","concurrencyMode":"PESSIMISTIC","versionRetentionPeriod":"3600s","earliestVersionTime":"2025-12-07T08:15:58.718911Z","appEngineIntegrationMode":"DISABLED","keyPrefix":"g","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_DISABLED","deleteProtectionState":"DELETE_PROTECTION_DISABLED","databaseEdition":"STANDARD","freeTier":true,"realtimeUpdatesMode":"REALTIME_UPDATES_MODE_ENABLED","etag":"IJaLtoOSq5EDMKWT/43Aj5ED"}
[debug] [2025-12-07T09:15:58.670Z] Skipping existing index: {"collectionGroup":"users","queryScope":"COLLECTION","fields":[{"fieldPath":"tier","order":"ASCENDING"},{"fieldPath":"createdAt","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}]}
[debug] [2025-12-07T09:15:58.670Z] Skipping existing index: {"collectionGroup":"alerts","queryScope":"COLLECTION","fields":[{"fieldPath":"isActive","order":"ASCENDING"},{"fieldPath":"createdAt","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}]}
[debug] [2025-12-07T09:15:58.671Z] Skipping existing index: {"collectionGroup":"alerts","queryScope":"COLLECTION","fields":[{"fieldPath":"targetAudience","arrayConfig":"CONTAINS"},{"fieldPath":"createdAt","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}]}
[debug] [2025-12-07T09:15:58.671Z] Skipping existing index: {"collectionGroup":"courses","queryScope":"COLLECTION","fields":[{"fieldPath":"isPremium","order":"ASCENDING"},{"fieldPath":"order","order":"ASCENDING"},{"fieldPath":"__name__","order":"ASCENDING"}]}
[debug] [2025-12-07T09:15:58.671Z] Skipping existing index: {"collectionGroup":"courses","queryScope":"COLLECTION","fields":[{"fieldPath":"level","order":"ASCENDING"},{"fieldPath":"order","order":"ASCENDING"},{"fieldPath":"__name__","order":"ASCENDING"}]}
[debug] [2025-12-07T09:15:58.671Z] Skipping existing index: {"collectionGroup":"homeCards","queryScope":"COLLECTION","fields":[{"fieldPath":"isActive","order":"ASCENDING"},{"fieldPath":"order","order":"ASCENDING"},{"fieldPath":"__name__","order":"ASCENDING"}]}
[debug] [2025-12-07T09:15:58.671Z] Skipping existing index: {"collectionGroup":"news","queryScope":"COLLECTION","fields":[{"fieldPath":"isPublished","order":"ASCENDING"},{"fieldPath":"publishedAt","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}]}
[debug] [2025-12-07T09:15:58.671Z] Skipping existing index: {"collectionGroup":"news","queryScope":"COLLECTION","fields":[{"fieldPath":"category","order":"ASCENDING"},{"fieldPath":"publishedAt","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}]}
[debug] [2025-12-07T09:15:58.671Z] Skipping existing index: {"collectionGroup":"tzadikim","queryScope":"COLLECTION","fields":[{"fieldPath":"location","order":"ASCENDING"},{"fieldPath":"name","order":"ASCENDING"},{"fieldPath":"__name__","order":"ASCENDING"}]}
[debug] [2025-12-07T09:15:58.671Z] Skipping existing index: {"collectionGroup":"prayerCommitments","queryScope":"COLLECTION","fields":[{"fieldPath":"userId","order":"ASCENDING"},{"fieldPath":"createdAt","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}]}
[debug] [2025-12-07T09:15:58.671Z] Skipping existing index: {"collectionGroup":"prayerCommitments","queryScope":"COLLECTION","fields":[{"fieldPath":"prayerType","order":"ASCENDING"},{"fieldPath":"status","order":"ASCENDING"},{"fieldPath":"createdAt","order":"ASCENDING"},{"fieldPath":"__name__","order":"ASCENDING"}]}
[debug] [2025-12-07T09:15:58.672Z] Skipping existing index: {"collectionGroup":"shortLessons","queryScope":"COLLECTION","fields":[{"fieldPath":"isActive","order":"ASCENDING"},{"fieldPath":"createdAt","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}]}
[debug] [2025-12-07T09:15:58.672Z] Skipping existing index: {"collectionGroup":"longLessons","queryScope":"COLLECTION","fields":[{"fieldPath":"isActive","order":"ASCENDING"},{"fieldPath":"createdAt","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}]}
[debug] [2025-12-07T09:15:58.672Z] Creating new index: {"collectionGroup":"notifications","queryScope":"COLLECTION","fields":[{"fieldPath":"isActive","order":"ASCENDING"},{"fieldPath":"createdAt","order":"DESCENDING"}]}
[debug] [2025-12-07T09:15:58.672Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:15:58.672Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:15:58.672Z] >>> [apiv2][query] POST https://firestore.googleapis.com/v1/projects/yank-99f79/databases/(default)/collectionGroups/notifications/indexes [none]
[debug] [2025-12-07T09:15:58.673Z] >>> [apiv2][body] POST https://firestore.googleapis.com/v1/projects/yank-99f79/databases/(default)/collectionGroups/notifications/indexes {"fields":[{"fieldPath":"isActive","order":"ASCENDING"},{"fieldPath":"createdAt","order":"DESCENDING"}],"queryScope":"COLLECTION"}
[debug] [2025-12-07T09:15:59.019Z] <<< [apiv2][status] POST https://firestore.googleapis.com/v1/projects/yank-99f79/databases/(default)/collectionGroups/notifications/indexes 200
[debug] [2025-12-07T09:15:59.019Z] <<< [apiv2][body] POST https://firestore.googleapis.com/v1/projects/yank-99f79/databases/(default)/collectionGroups/notifications/indexes {"name":"projects/yank-99f79/databases/(default)/operations/S0VKaW1qSmdBQ0lDDCoDIGNmNGVhZGRkODRmZi03MWFiLTBlODQtZDBjMS1hZWYzNzg2NCQac2VuaWxlcGlwCQpBEg","metadata":{"@type":"type.googleapis.com/google.firestore.admin.v1.IndexOperationMetadata","startTime":"2025-12-07T09:15:59.045417Z","index":"projects/yank-99f79/databases/(default)/collectionGroups/notifications/indexes/CICAgJjmiJEK","state":"INITIALIZING"}}
[info] ✔  firestore: deployed indexes in firestore.indexes.json successfully for (default) database 
[info] 
[info] ✔  Deploy complete! 
[info] 
[info] Project Console: https://console.firebase.google.com/project/yank-99f79/overview
[debug] [2025-12-07T09:19:18.735Z] ----------------------------------------------------------------------
[debug] [2025-12-07T09:19:18.738Z] Command:       /opt/homebrew/Cellar/node/24.4.1/bin/node /opt/homebrew/bin/firebase deploy --only firestore:rules
[debug] [2025-12-07T09:19:18.739Z] CLI Version:   14.25.1
[debug] [2025-12-07T09:19:18.739Z] Platform:      darwin
[debug] [2025-12-07T09:19:18.739Z] Node Version:  v24.4.1
[debug] [2025-12-07T09:19:18.739Z] Time:          Sun Dec 07 2025 11:19:18 GMT+0200 (Israel Standard Time)
[debug] [2025-12-07T09:19:18.739Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-12-07T09:19:18.849Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2025-12-07T09:19:18.849Z] > authorizing via signed-in user (orel895@gmail.com)
[debug] [2025-12-07T09:19:18.850Z] [iam] checking project yank-99f79 for permissions ["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]
[debug] [2025-12-07T09:19:18.850Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:19:18.850Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:19:18.851Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/yank-99f79:testIamPermissions [none]
[debug] [2025-12-07T09:19:18.851Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/yank-99f79:testIamPermissions x-goog-quota-user=projects/yank-99f79
[debug] [2025-12-07T09:19:18.851Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/yank-99f79:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[debug] [2025-12-07T09:19:19.889Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/yank-99f79:testIamPermissions 200
[debug] [2025-12-07T09:19:19.890Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/yank-99f79:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[info] 
[info] === Deploying to 'yank-99f79'...
[info] 
[info] i  deploying firestore 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[debug] [2025-12-07T09:19:19.892Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:19:19.892Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:19:19.892Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/yank-99f79/databases/(default) [none]
[debug] [2025-12-07T09:19:20.513Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/yank-99f79/databases/(default) 200
[debug] [2025-12-07T09:19:20.514Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/yank-99f79/databases/(default) {"name":"projects/yank-99f79/databases/(default)","uid":"4c5ad8af-061a-43e3-8b1d-835cacec1816","createTime":"2025-11-26T09:21:58.397949Z","updateTime":"2025-11-26T09:21:58.397949Z","locationId":"europe-west2","type":"FIRESTORE_NATIVE","concurrencyMode":"PESSIMISTIC","versionRetentionPeriod":"3600s","earliestVersionTime":"2025-12-07T08:19:20.557822Z","appEngineIntegrationMode":"DISABLED","keyPrefix":"g","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_DISABLED","deleteProtectionState":"DELETE_PROTECTION_DISABLED","databaseEdition":"STANDARD","freeTier":true,"realtimeUpdatesMode":"REALTIME_UPDATES_MODE_ENABLED","etag":"IKWs1eOSq5EDMKWT/43Aj5ED"}
[info] i  firestore: reading indexes from firestore.indexes.json... 
[info] i  cloud.firestore: checking native/firestore.rules for compilation errors... 
[debug] [2025-12-07T09:19:20.519Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:19:20.519Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:19:20.519Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/yank-99f79:test [none]
[debug] [2025-12-07T09:19:20.520Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/yank-99f79:test [omitted]
[debug] [2025-12-07T09:19:20.957Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/yank-99f79:test 200
[debug] [2025-12-07T09:19:20.958Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/yank-99f79:test {"issues":[{"sourcePosition":{"fileName":"native/firestore.rules","line":12,"column":14,"currentOffset":492,"endOffset":511},"description":"Unused function: isAuthenticatedAdmin.","severity":"WARNING"},{"sourcePosition":{"fileName":"native/firestore.rules","line":13,"column":14,"currentOffset":530,"endOffset":536},"description":"Invalid variable name: request.","severity":"WARNING"},{"sourcePosition":{"fileName":"native/firestore.rules","line":14,"column":14,"currentOffset":568,"endOffset":573},"description":"Invalid function name: exists.","severity":"WARNING"},{"sourcePosition":{"fileName":"native/firestore.rules","line":14,"column":62,"currentOffset":616,"endOffset":622},"description":"Invalid variable name: request.","severity":"WARNING"},{"sourcePosition":{"fileName":"native/firestore.rules","line":15,"column":14,"currentOffset":651,"endOffset":653},"description":"Invalid function name: get.","severity":"WARNING"},{"sourcePosition":{"fileName":"native/firestore.rules","line":15,"column":59,"currentOffset":696,"endOffset":702},"description":"Invalid variable name: request.","severity":"WARNING"}]}
[warn] ⚠  [W] 12:14 - Unused function: isAuthenticatedAdmin. 
[warn] ⚠  [W] 13:14 - Invalid variable name: request. 
[warn] ⚠  [W] 14:14 - Invalid function name: exists. 
[warn] ⚠  [W] 14:62 - Invalid variable name: request. 
[warn] ⚠  [W] 15:14 - Invalid function name: get. 
[warn] ⚠  [W] 15:59 - Invalid variable name: request. 
[info] ✔  cloud.firestore: rules file native/firestore.rules compiled successfully 
[debug] [2025-12-07T09:19:20.966Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:19:20.966Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:19:20.968Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/yank-99f79/releases pageSize=10&pageToken=
[debug] [2025-12-07T09:19:21.717Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/yank-99f79/releases 200
[debug] [2025-12-07T09:19:21.717Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/yank-99f79/releases {"releases":[{"name":"projects/yank-99f79/releases/cloud.firestore","rulesetName":"projects/yank-99f79/rulesets/47db76c2-0440-4f56-99fd-f6c64a57ac61","createTime":"2025-11-26T09:22:05.063899Z","updateTime":"2025-12-05T12:17:32.532386Z"},{"name":"projects/yank-99f79/releases/firebase.storage/yank-99f79.firebasestorage.app","rulesetName":"projects/yank-99f79/rulesets/1a497402-d683-421d-bdc6-ba7725f1699d","createTime":"2025-11-26T09:22:51.273810Z","updateTime":"2025-12-02T14:16:05.445605Z"}]}
[debug] [2025-12-07T09:19:21.749Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:19:21.749Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:19:21.749Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/yank-99f79/rulesets/47db76c2-0440-4f56-99fd-f6c64a57ac61 [none]
[debug] [2025-12-07T09:19:22.023Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/yank-99f79/rulesets/47db76c2-0440-4f56-99fd-f6c64a57ac61 200
[debug] [2025-12-07T09:19:22.023Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/yank-99f79/rulesets/47db76c2-0440-4f56-99fd-f6c64a57ac61 [omitted]
[info] i  firestore: uploading rules native/firestore.rules... 
[debug] [2025-12-07T09:19:22.024Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:19:22.024Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:19:22.024Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/yank-99f79/rulesets [none]
[debug] [2025-12-07T09:19:22.024Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/yank-99f79/rulesets [omitted]
[debug] [2025-12-07T09:19:22.927Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/yank-99f79/rulesets 200
[debug] [2025-12-07T09:19:22.927Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/yank-99f79/rulesets {"name":"projects/yank-99f79/rulesets/094b5df9-158a-4e9a-b3e4-791263aedf04","source":{"files":[{"content":"rules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Helper function to check if user is admin\n    function isAdmin() {\n      return request.auth != null && \n             exists(/databases/$(database)/documents/users/$(request.auth.uid)) &&\n             get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';\n    }\n    \n    // Helper function to check if user is authenticated and admin (with safe check)\n    function isAuthenticatedAdmin() {\n      return request.auth != null && \n             exists(/databases/$(database)/documents/users/$(request.auth.uid)) &&\n             get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';\n    }\n    \n    // Helper function to check if user is authenticated\n    function isAuthenticated() {\n      return request.auth != null;\n    }\n    \n    // Users collection\n    match /users/{userId} {\n      allow read: if isAuthenticated();\n      allow create: if isAuthenticated() && request.auth.uid == userId;\n      allow update: if isAuthenticated() && (request.auth.uid == userId || isAdmin());\n      allow delete: if isAdmin();\n    }\n    \n    // Public read, admin write for all content collections\n    match /prayers/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    // Prayer commitments - authenticated users only\n    match /prayerCommitments/{commitmentId} {\n      allow read: if isAuthenticated();\n      allow create: if isAuthenticated() && request.auth.uid == request.resource.data.userId;\n      allow update: if isAuthenticated() && \n        (request.auth.uid == resource.data.userId || \n         request.auth.uid == resource.data.assignedToUserId);\n      allow delete: if isAdmin();\n    }\n    \n    match /newsletters/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /music/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /dailyInsights/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /books/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /lessons/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /news/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /contact/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    // Home Cards - public read, admin write\n    match /homeCards/{cardId} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /about/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /donations/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /courses/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /cards/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /recommendations/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /tzadikim/{document=**} {\n      allow read: if true;\n      allow create: if isAdmin();\n      allow update: if isAdmin();\n      allow delete: if isAdmin();\n    }\n    \n    match /dailyLearning/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /chidushim/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /shortLessons/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /longLessons/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    // Notifications - authenticated users can read, admin can write\n    match /notifications/{notificationId} {\n      allow read: if isAuthenticated();\n      allow create: if isAdmin();\n      allow update: if isAdmin();\n      allow delete: if isAdmin();\n    }\n    \n    // Daily Videos - authenticated users can read, admin can write\n    match /dailyVideos/{document=**} {\n      allow read: if isAuthenticated();\n      allow write: if isAdmin();\n    }\n    \n    // Beit Midrash Videos - public read, admin write\n    match /beitMidrashVideos/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n  }\n}\n","name":"native/firestore.rules"}]},"createTime":"2025-12-07T09:19:22.911151Z","metadata":{"services":["cloud.firestore"]}}
[debug] [2025-12-07T09:19:22.927Z] [rules] created ruleset projects/yank-99f79/rulesets/094b5df9-158a-4e9a-b3e4-791263aedf04
[debug] [2025-12-07T09:19:22.928Z] [rules] releasing cloud.firestore/(default) with ruleset projects/yank-99f79/rulesets/094b5df9-158a-4e9a-b3e4-791263aedf04
[debug] [2025-12-07T09:19:22.928Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:19:22.928Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:19:22.928Z] >>> [apiv2][query] PATCH https://firebaserules.googleapis.com/v1/projects/yank-99f79/releases/cloud.firestore/(default) [none]
[debug] [2025-12-07T09:19:22.928Z] >>> [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/yank-99f79/releases/cloud.firestore/(default) {"release":{"name":"projects/yank-99f79/releases/cloud.firestore/(default)","rulesetName":"projects/yank-99f79/rulesets/094b5df9-158a-4e9a-b3e4-791263aedf04"}}
[debug] [2025-12-07T09:19:23.939Z] <<< [apiv2][status] PATCH https://firebaserules.googleapis.com/v1/projects/yank-99f79/releases/cloud.firestore/(default) 200
[debug] [2025-12-07T09:19:23.939Z] <<< [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/yank-99f79/releases/cloud.firestore/(default) {"name":"projects/yank-99f79/releases/cloud.firestore","rulesetName":"projects/yank-99f79/rulesets/094b5df9-158a-4e9a-b3e4-791263aedf04","createTime":"2025-11-26T09:22:05.063899Z","updateTime":"2025-12-07T09:19:23.809956Z"}
[debug] [2025-12-07T09:19:23.939Z] [rules] updated release projects/yank-99f79/releases/cloud.firestore
[info] ✔  firestore: released rules native/firestore.rules to cloud.firestore 
[info] 
[info] ✔  Deploy complete! 
[info] 
[info] Project Console: https://console.firebase.google.com/project/yank-99f79/overview
[debug] [2025-12-07T09:20:05.363Z] ----------------------------------------------------------------------
[debug] [2025-12-07T09:20:05.367Z] Command:       /opt/homebrew/Cellar/node/24.4.1/bin/node /opt/homebrew/bin/firebase deploy --only firestore:rules
[debug] [2025-12-07T09:20:05.367Z] CLI Version:   14.25.1
[debug] [2025-12-07T09:20:05.367Z] Platform:      darwin
[debug] [2025-12-07T09:20:05.367Z] Node Version:  v24.4.1
[debug] [2025-12-07T09:20:05.367Z] Time:          Sun Dec 07 2025 11:20:05 GMT+0200 (Israel Standard Time)
[debug] [2025-12-07T09:20:05.367Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-12-07T09:20:05.512Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2025-12-07T09:20:05.513Z] > authorizing via signed-in user (orel895@gmail.com)
[debug] [2025-12-07T09:20:05.513Z] [iam] checking project yank-99f79 for permissions ["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]
[debug] [2025-12-07T09:20:05.514Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:20:05.514Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:20:05.514Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/yank-99f79:testIamPermissions [none]
[debug] [2025-12-07T09:20:05.514Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/yank-99f79:testIamPermissions x-goog-quota-user=projects/yank-99f79
[debug] [2025-12-07T09:20:05.514Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/yank-99f79:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[debug] [2025-12-07T09:20:05.874Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/yank-99f79:testIamPermissions 200
[debug] [2025-12-07T09:20:05.874Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/yank-99f79:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[info] 
[info] === Deploying to 'yank-99f79'...
[info] 
[info] i  deploying firestore 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[debug] [2025-12-07T09:20:05.877Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:20:05.877Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:20:05.877Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/yank-99f79/databases/(default) [none]
[debug] [2025-12-07T09:20:06.464Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/yank-99f79/databases/(default) 200
[debug] [2025-12-07T09:20:06.464Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/yank-99f79/databases/(default) {"name":"projects/yank-99f79/databases/(default)","uid":"4c5ad8af-061a-43e3-8b1d-835cacec1816","createTime":"2025-11-26T09:21:58.397949Z","updateTime":"2025-11-26T09:21:58.397949Z","locationId":"europe-west2","type":"FIRESTORE_NATIVE","concurrencyMode":"PESSIMISTIC","versionRetentionPeriod":"3600s","earliestVersionTime":"2025-12-07T08:20:06.508108Z","appEngineIntegrationMode":"DISABLED","keyPrefix":"g","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_DISABLED","deleteProtectionState":"DELETE_PROTECTION_DISABLED","databaseEdition":"STANDARD","freeTier":true,"realtimeUpdatesMode":"REALTIME_UPDATES_MODE_ENABLED","etag":"IP33yfmSq5EDMKWT/43Aj5ED"}
[info] i  firestore: reading indexes from firestore.indexes.json... 
[info] i  cloud.firestore: checking native/firestore.rules for compilation errors... 
[debug] [2025-12-07T09:20:06.467Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:20:06.468Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:20:06.468Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/yank-99f79:test [none]
[debug] [2025-12-07T09:20:06.468Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/yank-99f79:test [omitted]
[debug] [2025-12-07T09:20:07.377Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/yank-99f79:test 200
[debug] [2025-12-07T09:20:07.377Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/yank-99f79:test {}
[info] ✔  cloud.firestore: rules file native/firestore.rules compiled successfully 
[debug] [2025-12-07T09:20:07.380Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:20:07.380Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:20:07.380Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/yank-99f79/releases pageSize=10&pageToken=
[debug] [2025-12-07T09:20:07.744Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/yank-99f79/releases 200
[debug] [2025-12-07T09:20:07.744Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/yank-99f79/releases {"releases":[{"name":"projects/yank-99f79/releases/cloud.firestore","rulesetName":"projects/yank-99f79/rulesets/094b5df9-158a-4e9a-b3e4-791263aedf04","createTime":"2025-11-26T09:22:05.063899Z","updateTime":"2025-12-07T09:19:23.809956Z"},{"name":"projects/yank-99f79/releases/firebase.storage/yank-99f79.firebasestorage.app","rulesetName":"projects/yank-99f79/rulesets/1a497402-d683-421d-bdc6-ba7725f1699d","createTime":"2025-11-26T09:22:51.273810Z","updateTime":"2025-12-02T14:16:05.445605Z"}]}
[debug] [2025-12-07T09:20:07.769Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:20:07.769Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:20:07.769Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/yank-99f79/rulesets/094b5df9-158a-4e9a-b3e4-791263aedf04 [none]
[debug] [2025-12-07T09:20:08.497Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/yank-99f79/rulesets/094b5df9-158a-4e9a-b3e4-791263aedf04 200
[debug] [2025-12-07T09:20:08.497Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/yank-99f79/rulesets/094b5df9-158a-4e9a-b3e4-791263aedf04 [omitted]
[info] i  firestore: uploading rules native/firestore.rules... 
[debug] [2025-12-07T09:20:08.498Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:20:08.498Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:20:08.498Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/yank-99f79/rulesets [none]
[debug] [2025-12-07T09:20:08.498Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/yank-99f79/rulesets [omitted]
[debug] [2025-12-07T09:20:09.412Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/yank-99f79/rulesets 200
[debug] [2025-12-07T09:20:09.412Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/yank-99f79/rulesets {"name":"projects/yank-99f79/rulesets/0818df1f-d0e2-4808-9c77-100cc228d3bf","source":{"files":[{"content":"rules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Helper function to check if user is admin\n    function isAdmin() {\n      return request.auth != null && \n             exists(/databases/$(database)/documents/users/$(request.auth.uid)) &&\n             get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';\n    }\n    \n    // Helper function to check if user is authenticated\n    function isAuthenticated() {\n      return request.auth != null;\n    }\n    \n    // Users collection\n    match /users/{userId} {\n      allow read: if isAuthenticated();\n      allow create: if isAuthenticated() && request.auth.uid == userId;\n      allow update: if isAuthenticated() && (request.auth.uid == userId || isAdmin());\n      allow delete: if isAdmin();\n    }\n    \n    // Public read, admin write for all content collections\n    match /prayers/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    // Prayer commitments - authenticated users only\n    match /prayerCommitments/{commitmentId} {\n      allow read: if isAuthenticated();\n      allow create: if isAuthenticated() && request.auth.uid == request.resource.data.userId;\n      allow update: if isAuthenticated() && \n        (request.auth.uid == resource.data.userId || \n         request.auth.uid == resource.data.assignedToUserId);\n      allow delete: if isAdmin();\n    }\n    \n    match /newsletters/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /music/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /dailyInsights/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /books/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /lessons/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /news/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /contact/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    // Home Cards - public read, admin write\n    match /homeCards/{cardId} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /about/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /donations/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /courses/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /cards/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /recommendations/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /tzadikim/{document=**} {\n      allow read: if true;\n      allow create: if isAdmin();\n      allow update: if isAdmin();\n      allow delete: if isAdmin();\n    }\n    \n    match /dailyLearning/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /chidushim/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /shortLessons/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /longLessons/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    // Notifications - authenticated users can read, admin can write\n    match /notifications/{notificationId} {\n      allow read: if isAuthenticated();\n      allow create: if isAdmin();\n      allow update: if isAdmin();\n      allow delete: if isAdmin();\n    }\n    \n    // Daily Videos - authenticated users can read, admin can write\n    match /dailyVideos/{document=**} {\n      allow read: if isAuthenticated();\n      allow write: if isAdmin();\n    }\n    \n    // Beit Midrash Videos - public read, admin write\n    match /beitMidrashVideos/{document=**} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n  }\n}\n","name":"native/firestore.rules"}]},"createTime":"2025-12-07T09:20:09.399631Z","metadata":{"services":["cloud.firestore"]}}
[debug] [2025-12-07T09:20:09.412Z] [rules] created ruleset projects/yank-99f79/rulesets/0818df1f-d0e2-4808-9c77-100cc228d3bf
[debug] [2025-12-07T09:20:09.413Z] [rules] releasing cloud.firestore/(default) with ruleset projects/yank-99f79/rulesets/0818df1f-d0e2-4808-9c77-100cc228d3bf
[debug] [2025-12-07T09:20:09.413Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:20:09.413Z] Checked if tokens are valid: true, expires at: 1765102554353
[debug] [2025-12-07T09:20:09.413Z] >>> [apiv2][query] PATCH https://firebaserules.googleapis.com/v1/projects/yank-99f79/releases/cloud.firestore/(default) [none]
[debug] [2025-12-07T09:20:09.413Z] >>> [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/yank-99f79/releases/cloud.firestore/(default) {"release":{"name":"projects/yank-99f79/releases/cloud.firestore/(default)","rulesetName":"projects/yank-99f79/rulesets/0818df1f-d0e2-4808-9c77-100cc228d3bf"}}
[debug] [2025-12-07T09:20:10.335Z] <<< [apiv2][status] PATCH https://firebaserules.googleapis.com/v1/projects/yank-99f79/releases/cloud.firestore/(default) 200
[debug] [2025-12-07T09:20:10.335Z] <<< [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/yank-99f79/releases/cloud.firestore/(default) {"name":"projects/yank-99f79/releases/cloud.firestore","rulesetName":"projects/yank-99f79/rulesets/0818df1f-d0e2-4808-9c77-100cc228d3bf","createTime":"2025-11-26T09:22:05.063899Z","updateTime":"2025-12-07T09:20:10.317865Z"}
[debug] [2025-12-07T09:20:10.335Z] [rules] updated release projects/yank-99f79/releases/cloud.firestore
[info] ✔  firestore: released rules native/firestore.rules to cloud.firestore 
[info] 
[info] ✔  Deploy complete! 
[info] 
[info] Project Console: https://console.firebase.google.com/project/yank-99f79/overview
